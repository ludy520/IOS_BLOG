#再谈谈IOS的分类
源于前几天去金风科技无锡研发中心面试，被问及在IOS的分类中，@property是否需要特殊处理，当时直接回复了属性不需要，实例变量需要特殊处理。

##runtime
那先从runtime来说说分类的问题。
![-w718](media/15565428551903/15565437862744.jpg)
在 **category_t** 结构中，重要的就是上图红色方框处的4个变量，表示着方法、协议和属性。**所以category结构本身就直接支持方法、协议和属性** 这也是我们常常说的，在分类中可以添加方法、协议和属性。

##代码上
###首先
```
@interface Person : NSObject

@property(nonatomic,strong)NSString *name;

@end
```
```
@implementation Person

@synthesize name = _name;

@end
```
比如上面代码中的 ***@synthesize name = _name;*** 先让我们来搞清楚这个是干嘛用的。

现在基本很少再看到 ***@synthesize*** 这个关键字，在以前的Xcode中，这个关键字也是一个必备关键字，用来绑定 ***属性*** 和 ***实例变量*** 。自从编译器换成 ***llvm*** 之后，声明 **@property(nonatomic,strong)NSString *name;** 之后,会自动生成一个相对应的 ***_name*** 的实例变量。

###做一次变化
![-w395](media/15565428551903/15565453632503.jpg)

![-w505](media/15565428551903/15565454091940.jpg)

从上图可以看到，虽然是只声明了属性，但是相对应的实例变量也是有了。看起来就像 ***ARC*** 和 ***MRC*** 那样，在ARC下，虽然不用再写 ***release*** 方法了，但实际上是编译器帮我们把 ***release*** 方法插到了需要的地方。所以说 ***属性*** 不等同于 ***实例变量***。

###再做一次改变
![-w428](media/15565428551903/15565458961135.jpg)
![-w449](media/15565428551903/15565459145293.jpg)
![-w672](media/15565428551903/15565459431466.jpg)

第一幅截图所示，在宿主类中添加实例变量是没问题的
第三幅截图所示，在第二幅截图的基础上添加实例变量，就报错了,这个跟 ***category_t*** 的结构相符。

###再来
![-w449](media/15565428551903/15565462756496.jpg)
![-w442](media/15565428551903/15565464667295.jpg)
![-w522](media/15565428551903/15565464923996.jpg)
![-w706](media/15565428551903/15565465077609.jpg)

可以在控制台上看到调用了分类的方法，所以， ***@property*** 是 ***getter*** 和 ***setter*** 方法的声明，并不包括相对应的实例变量。

###所以
* 在 ***category_t*** 中，***@property*** 和 ***@protocal*** 其实质就是方法。

* 在分类中无法定义实例变量，所以要像实例变量那样存储  ***value*** 就必须借助其他的存储空间，比如全局容器 ***AssociationsHashMap*** ,因此就用到了关联对象。

* 目前，网上好多分类中的属性的setter和getter方法中直接用关联对象来处理，并不是说在 ***分类*** 中，使用 ***@property*** 一定要关联对象，***@property***    其实质是方法，**只有为了添加实例变量的时候才一定要使用关联对象**。

